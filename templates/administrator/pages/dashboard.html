{% extends 'administrator/Admindashboardbase.html' %}
{% load static %}
{% block title %}
  Dashboard
{% endblock %}
{% load widget_tweaks %}
{% block content %}
  {% include 'administrator/partials/header.html' %}
  {% include 'administrator/partials/sidebar.html' %}

  <div class="app-container">
    <div class="app-main" id="main">
      <div class="container-fluid">
        <div class="row">
          <!-- Card 1: Total Customers -->
          <div class="col-md-3 mb-4">
            <div class="card bg-light shadow-sm border-0 rounded-3 p-3" style="height: 180px;"> <!-- Adjusted height here -->
              <div class="card-body d-flex flex-column align-items-center text-center">
                <div class="icon-container bg-primary text-white rounded-circle d-flex justify-content-center align-items-center" style="width: 45px; height: 45px;">
                  <i class="fe fe-user" style="font-size: 1.2rem;"></i>
                </div>
                <p class="card-title mt-3">Total Customers</p>
                <h5 class="value" id="totalCustomers">Loading...</h5>
              </div>
            </div>
          </div>

          <!-- Card 2: Total Loan Requests -->
          <div class="col-md-3 mb-4">
            <div class="card bg-light shadow-sm border-0 rounded-3 p-3" style="height: 180px;"> <!-- Adjusted height here -->
              <div class="card-body d-flex flex-column align-items-center text-center">
                <div class="icon-container bg-success text-white rounded-circle d-flex justify-content-center align-items-center" style="width: 45px; height: 45px;">
                  <i class="fe fe-credit-card" style="font-size: 1.2rem;"></i>
                </div>
                <p class="card-title mt-3">Total Loan Requests</p>
                <h5 class="value" id="totalLoanRequests">Loading...</h5>
              </div>
            </div>
          </div>

          <!-- Card 3: Total Approved Requests -->
          <div class="col-md-3 mb-4">
            <div class="card bg-light shadow-sm border-0 rounded-3 p-3" style="height: 180px;"> <!-- Adjusted height here -->
              <div class="card-body d-flex flex-column align-items-center text-center">
                <div class="icon-container bg-warning text-white rounded-circle d-flex justify-content-center align-items-center" style="width: 45px; height: 45px;">
                  <i class="fe fe-check-circle" style="font-size: 1.2rem;"></i>
                </div>
                <p class="card-title mt-3">Approved Requests</p>
                <h5 class="value" id="totalApprovedRequests">Loading...</h5>
              </div>
            </div>
          </div>

          <!-- Card 4: Total Declined Requests -->
          <div class="col-md-3 mb-4">
            <div class="card bg-light shadow-sm border-0 rounded-3 p-3" style="height: 180px;"> <!-- Adjusted height here -->
              <div class="card-body d-flex flex-column align-items-center text-center">
                <div class="icon-container bg-danger text-white rounded-circle d-flex justify-content-center align-items-center" style="width: 45px; height: 45px;">
                  <i class="fe fe-x-circle" style="font-size: 1.2rem;"></i>
                </div>
                <p class="card-title mt-3">Declined Requests</p>
                <h5 class="value" id="totalDeclinedRequests">Loading...</h5>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <!-- Card 5: This Month's New Users -->
          <div class="col-md-3 mb-4">
            <div class="card bg-light shadow-sm border-0 rounded-3 p-3" style="height: 180px;"> <!-- Adjusted height here -->
              <div class="card-body d-flex flex-column align-items-center text-center">
                <div class="icon-container bg-primary text-white rounded-circle d-flex justify-content-center align-items-center" style="width: 45px; height: 45px;">
                  <i class="fe fe-calendar" style="font-size: 1.2rem;"></i>
                </div>
                <p class="card-title mt-3">This Month's New Users</p>
                <h5 class="value" id="thisMonthNewUsers">Loading...</h5>
              </div>
            </div>
          </div>

          <!-- Card 6: This Week's New Users -->
          <div class="col-md-3 mb-4">
            <div class="card bg-light shadow-sm border-0 rounded-3 p-3" style="height: 180px;"> <!-- Adjusted height here -->
              <div class="card-body d-flex flex-column align-items-center text-center">
                <div class="icon-container bg-success text-white rounded-circle d-flex justify-content-center align-items-center" style="width: 45px; height: 45px;">
                  <i class="fe fe-calendar" style="font-size: 1.2rem;"></i>
                </div>
                <p class="card-title mt-3">This Week's New Users</p>
                <h5 class="value" id="thisWeekNewUsers">Loading...</h5>
              </div>
            </div>
          </div>

          <!-- Card 7: Total Savings -->
          <div class="col-md-3 mb-4">
            <div class="card bg-light shadow-sm border-0 rounded-3 p-3" style="height: 180px;"> <!-- Adjusted height here -->
              <div class="card-body d-flex flex-column align-items-center text-center">
                <div class="icon-container bg-warning text-white rounded-circle d-flex justify-content-center align-items-center" style="width: 45px; height: 45px;">
                  <i class="fe fe-dollar-sign" style="font-size: 1.2rem;"></i>
                </div>
                <p class="card-title mt-3">Total Savings</p>
                <h5 class="value" id="totalSavings">Loading...</h5>
              </div>
            </div>
          </div>

          <!-- Card 8: Total Repayment Due -->
          <div class="col-md-3 mb-4">
            <div class="card bg-light shadow-sm border-0 rounded-3 p-3" style="height: 180px;"> <!-- Adjusted height here -->
              <div class="card-body d-flex flex-column align-items-center text-center">
                <div class="icon-container bg-danger text-white rounded-circle d-flex justify-content-center align-items-center" style="width: 45px; height: 45px;">
                  <i class="fe fe-dollar-sign" style="font-size: 1.2rem;"></i>
                </div>
                <p class="card-title mt-3">Total Repayment Due</p>
                <h5 class="value" id="totalRepaymentDue">Loading...</h5>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    {% include 'administrator/partials/footer.html' %}
  </div>

  
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script>
    $(document).ready(function () {
        // Fetch statistics data
        var accessToken = localStorage.getItem('access_token');
        if (!accessToken) {
            console.error('Access token not found in local storage');
            return;
        }
    
        $.ajax({
            url: '{{ BASE_API_URL }}/admin/dashboard-stats',  // Update this URL with your actual endpoint
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + accessToken
            },
            success: function (response) {
                if (response.status) {
                    // Update each card with the corresponding data
                    $('#totalCustomers').text(response.data.customercount);
                    $('#totalLoanRequests').text(response.data.loanscount);
                    $('#totalApprovedRequests').text(response.data.approvedloanscount);
                    $('#totalDeclinedRequests').text(response.data.rejectedloanscount);
                    $('#thisMonthNewUsers').text(response.data.customermonthcount);
                    $('#thisWeekNewUsers').text(response.data.customerweekcount);
                    $('#totalSavings').text('₦' + response.data.totalsavingamount.toLocaleString());
                    $('#totalRepaymentDue').text('₦' + response.data.totalsaving_due_amount.toLocaleString());
                } else {
                    console.error('Error fetching data: ' + response.message);
                }
            },
            error: function (xhr, status, error) {
                console.error('AJAX Error: ' + status + ' - ' + error);
            }
        });
    });
</script>
{% endblock %}
